<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link href="static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="static/h-ui.admin/css/H-ui.login.css" rel="stylesheet" type="text/css" />
<link href="static/h-ui.admin/css/style.css" rel="stylesheet" type="text/css" />
<link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<script src="js/vue.min.js" type="text/javascript"></script>
    <script src="js/vue-resource.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="css/css.css" />
    <style>
    #forget{padding-bottom: 19px;padding-top: 15px;}
  #forget_code{cursor: pointer;}
  #forget_code:hover{color: red;}
  .weui_btn{background-color: #5eb95e;width: 117px;font-size: 14px;padding: 10px;border: none;border-radius: 10px;color: #fff;cursor: pointer;}
  .pas_t{text-align: center;font-size: 24px;height: 38px;line-height: 34px;margin-bottom: 4px;}
  .loginBox .mt0{margin-top: 0;}
  /*.btn.cpd{padding: 8px 30px;}*/
        .loginBox{padding: 20px 0}
        .login_head{font-size: 25px;line-height: 60px;color: #fff}
    </style>
<title>忘记密码</title>
</head>
<body>
<input type="hidden" id="TenantId" name="TenantId" value="" />
<div class="header login_head">忘记密码</div>
<div class="loginWraper">
    <div class="header login_head"></div>
  <div class="loginBox" style="padding-top: 58px" id="app">

      
      <div class="row cl">
        <label class="form-label col-xs-3" style="text-align: right"><i class="Hui-iconfont">&#xe6c7;</i></label>
        <div class="formControls col-xs-8">
          <input id="phone" type="text" placeholder="输入手机号" class="input-text size-L">
        </div>
      </div>
      <div class="verifyvt">
            <div id="tip_phone"></div>
        </div>
        
      <div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          <input id="check_code" class="input-text size-L" type="text" placeholder="验证码" style="width:200px;">
          <input type="button" class="weui_btn" value="获取验证码" onclick="clickButton(this)">
        </div>
      </div>
      <div class="verifyvt">
            <div id="tip_code"></div>
        </div>
      <!--<div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          &lt;!&ndash;<label for="online">
            <input type="checkbox" name="online" id="online" value="">
            使我保持登录状态</label>&ndash;&gt;
        </div>
      </div>-->
      <div class="row cl">
        <label class="form-label col-xs-3" style="text-align: right"><i class="Hui-iconfont">&#xe60e;</i></label>
        <div class="formControls col-xs-8">
          <input id="new_password" type="password" placeholder="输入新密码" class="input-text size-L">
        </div>
      </div>
      <div class="verifyvt">
            <div id="tip_password"></div>
        </div>
      <div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          <input id="save" type="button" class="btn btn-success radius size-L" value="&nbsp;提&nbsp;&nbsp;&nbsp;&nbsp;交&nbsp;">
            <a href="login.html" style="margin-left: 20px">返回</a>
        </div>
      </div>
  </div>
</div>
<div class="footer"></div>
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="js/md5.min.js"></script>
<script type="text/javascript" src="js/tan.js" ></script>
<script>
	document.getElementById("save").onclick=function(){
		
		var new_password = document.getElementById("new_password").value;
		var phone = document.getElementById("phone").value;
		var code = document.getElementById("check_code").value;
		
		
		var tip_password = document.getElementById("tip_password");
		var tip_phone = document.getElementById("tip_phone");
		var tip_code = document.getElementById("tip_code");
		var user_name_checkcode = /^([a-z]|[A-Z])+([a-z]|[A-Z]|[0-9]){5,17}$/;
		var check_phone = /^0?(13[0-9]|15[012356789]|17[013678]|18[0-9]|14[57])[0-9]{8}$/;
		var check_code = /^[0-9]{6}$/;
		if(phone==""){
			tip_phone.innerHTML = "请输入手机号码";
			return false;
		}
		if(!check_phone.test(phone)){
			tip_phone.innerHTML="手机号码不正确";
			return false;
		}
		if(code==""){
			tip_phone.innerHTML="";
			tip_code.innerHTML="请输入验证码";
			return false;
		}
		if(!check_code.test(code)){
			tip_phone.innerHTML="";
			tip_code.innerHTML="请输入6位数的验证码";
			return false;
		}
		if(new_password==""){
			tip_code.innerHTML="";
			tip_password.innerHTML = "请输入新密码";
			return false;
		}
		if(!user_name_checkcode.test(new_password)){
			tip_code.innerHTML="";
			tip_password.innerHTML = "格式不正确！密码由数字、字母组成，长度为8-18位。且不能为数字开头";
			return false;
		}
		tip_phone.innerHTML="";
		tip_code.innerHTML="";
		tip_password.innerHTML="";
		var hash_password = md5(new_password);//md5加密
		Vue.http.options.emulateJSON = true;
        Vue.http.options.headers = {
                        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                    };
		new Vue({
			el:"#app",
			data:{
				pots:{}
			},
			ready:function(){
				this.$http.post("http://www.qubitrich.com/commen/pc/resetPassword",{telephone:phone,password:hash_password,verifyCode:code}).then(function(res){
					if(res.data.code=="R0003"){//验证码错误或者失效
						tip_code.innerHTML="验证码错误或者失效";
						//tip_password.innerHTML=res.data.message;
					}else{
						sc_show(res.data.result);
						var t=setTimeout(function(){
							window.location.href="login.html"
						},1200)
					}
					console.log(res.data);
				})
			}
		})
	}
	
  function clickButton(obj){
  	var phone = document.getElementById("phone").value;
  	var tip_code = document.getElementById("tip_code");
  	var check_phone = /^0?(13[0-9]|15[012356789]|17[013678]|18[0-9]|14[57])[0-9]{8}$/;
  	if(phone==""){
  		document.getElementById("tip_phone").innerHTML="请输入手机号码"
  	}
  	if(!check_phone.test(phone)){
  		document.getElementById("tip_phone").innerHTML="手机号码不正确"
  	}else{
  		document.getElementById("tip_phone").innerHTML=""
  		//验证码倒计时
  		var obj = $(obj);
    obj.attr("disabled","disabled").css("background-color","#e6e6e6");/*按钮倒计时*/
    var time = 60;
    var set=setInterval(function(){
      obj.val(--time+"(s)");
    }, 1000);/*等待时间*/
    setTimeout(function(){
      obj.attr("disabled",false).val("获取验证码").css("background-color","#5eb95e");/*倒计时*/
      clearInterval(set);
    }, 60000);
  		
  		//获取验证码
  		Vue.http.options.emulateJSON = true;
        Vue.http.options.headers = {
                        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                    };
		new Vue({
			el:"#app",
			data:{
				pots:{}
			},
			ready:function(){
				this.$http.post("http://www.qubitrich.com/commen/app/getVerifyCode",{telephone:phone}).then(function(res){
					if(code='YP22'){
						tip_code.innerHTML=res.data.message;
					}
				})
			}
		})
  	}
  	
    
  }
</script>
</body>
</html>