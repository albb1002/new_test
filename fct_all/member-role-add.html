<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />

<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
<link rel="stylesheet" href="css/intlTelInput.css" />
<link rel="stylesheet" href="css/demo.css" />
    <script src="js/vue.min.js"></script>
    <script src="js/vue-resource.min.js"></script>
	
<style>
.tip{color: red;}
    .n-user{
        position: relative;}
.cl{margin-bottom: 10px;}
    #check_user{position:absolute;right: 10px;top: 0}
</style>
<title>添加账号</title>
</head> 
<body>
<article class="page-container" id="app">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>设置会员名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user">
				<input type="text" class="input-text" v-model="check.user" @blur="check_input">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_user}}
			</div>
		</div>
		
		
		<div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>设置密码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="password" class="input-text" v-model="check.passwords" @blur="check_input">
            </div>
        </div>
        <div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_passwords}}
			</div>
		</div>
		

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>确认密码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="password" class="input-text" v-model="check.comfirm_password" @blur="check_input">
            </div>
        </div>
        <div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_comfirm_password}}
			</div>
		</div>
		
		<div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>您的手机号码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                	<input id="phone" type="tel" class="input-text">
            </div>
        </div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_phone}}
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>证件类型：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user">
				<select id="select" @change="check_input">
					<option value="1">身份证</option>
					<option value="2">护照</option> 
					<option value="3">驾照</option>
				</select>
			</div>
		</div>
<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				
			</div>
		</div>
		
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>证件号码：</label>
			<div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" v-model="check.zjnumber" @blur="check_input">
            </div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_zjnumber}}
			</div>
		</div>
        
		

		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3">推荐人手机号码（选填）：</label>
			<div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" v-model="check.tjphone" @blur="check_input">
            </div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-3" style="visibility: hidden;"><span class="c-red">*</span>设置登入名：</label>
			<div class="formControls col-xs-8 col-sm-9 n-user tip">
				{{tip.tip_tjphone}}
			</div>
		</div>
		
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
				<button type="submit" class="btn btn-success radius" v-on:click="save_account"><i class="icon-ok"></i> 确定</button>
			</div>
		</div>
		
	

</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="js/md5.min.js"></script>
<script type="text/javascript" src="js/tan.js" ></script>
<script type="text/javascript" src="js/intlTelInput.js" ></script>
<script>
    $("#phone").intlTelInput({
      initialCountry: "CN",
      utilsScript: "js/utils.js"
    });
  </script>
<script>

Vue.http.options.emulateJSON = true;
    Vue.http.options.headers = {
        'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
    };
    Vue.http.options.headers = {
        'authorization': sessionStorage.token_name
    };
new Vue({
	el:"#app",
	data:{
		url_user_add:"http://www.qubitrich.com/pc/user/create",//创建角色地址
		pots:{},
		check:{
			user:"",//用户名
			passwords:"",//密码
			comfirm_password:"",//确认密码
			op:"",//区号
			country:"",//国家
			zjnumber:"",//证件号码
			tjphone:"",//推荐人号码
			zjobj:""//证件类型
		},
		tip:{
			tip_user:"",
			tip_passwords:"",
			tip_comfirm_password:"",
			tip_phone:"",
			tip_name:"",
			tip_zjnumber:"",
			tip_tjphone:""
		}
	}, 
	methods:{
		check_input:function(){
			var check_account = /^([a-z]|[A-Z])+([a-z]|[A-Z]|[0-9]){5,17}$/;
			var check_name = /^([\u4e00-\u9fa5]+|[a-zA-Z0-9]+)$/;
			var check_phone = /^0?(13[0-9]|15[012356789]|17[013678]|18[0-9]|14[57])[0-9]{8}$/;
			var check_num = /^[1-9]\d*$/;
			var selects = document.getElementById("select").value;
			var phone = document.getElementById("phone");
			if(!check_account.test(this.check.user)){
				this.tip.tip_user="格式不正确！用户名由数字、字母组成，长度为6-18位。且不能为数字开头"
				return false;
			}
			
			if(!check_account.test(this.check.passwords)){
				this.tip.tip_user="";
				this.tip.tip_passwords="格式不正确！密码由数字、字母组成，长度为6-18位。且不能为数字开头"
				return false;
			}
			if(this.check.passwords==this.check.user){
				this.tip.tip_user="";
				this.tip.tip_passwords="用户名和密码不能一样"
				return false;
			}
			if(this.check.comfirm_password !=this.check.passwords){
				this.tip.tip_passwords="";
				this.tip.tip_comfirm_password="两次输入不一样";
				return false;
			}
			
			if(!check_phone.test(phone.value)){
				this.tip.tip_comfirm_password="";
				this.tip.tip_phone="请输入正确的手机号码";
				return false;
			}

			if(selects=='1'){
				this.check.zjobj="身份证";
				this.tip.tip_phone="";
				var isIDCard1=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/; //15位数
				var isIDCard2=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
				if(isIDCard1.test(this.check.zjnumber)||isIDCard2.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "";
					
				}else{
					this.tip.tip_zjnumber = "请输入正确的身份证号码";
					return false;
				}
			}
			if(selects=='2'){
				this.check.zjobj="护照";
				this.tip.tip_phone="";
				var check = /^1[45][0-9]{7}|G[0-9]{8}|P[0-9]{7}|S[0-9]{7,8}|D[0-9]+$/
				if(!check.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "请输入正确的护照号码";
					return false;
				}
			}
			if(selects=='3'){
				this.check.zjobj="驾照";
				this.tip.tip_phone="";
				var check = /^[1-9]*[1-9][0-9]*$/;
				
				if(check.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "";
					
				}else{
					this.tip.tip_zjnumber = "请输入驾照号码";
					return false;
				}
			}
			
			if(this.check.tjphone==""){
				this.tip.tip_tjphone="";
			}
			else if(check_phone.test(this.check.tjphone)){
				this.tip.tip_tjphone="";				
			}else{
				this.tip.tip_tjphone="请输入正确的手机号码";
				return false;
			}
			
		},
		save_account:function(){
			var check_account = /^([a-z]|[A-Z])+([a-z]|[A-Z]|[0-9]){5,17}$/;
			var check_name = /^([\u4e00-\u9fa5]+|[a-zA-Z0-9]+)$/;
			var check_phone = /^0?(13[0-9]|15[012356789]|17[013678]|18[0-9]|14[57])[0-9]{8}$/;
			var check_num = /^[1-9]\d*$/;
			var selects = document.getElementById("select").value;
			var phone = document.getElementById("phone");
			if(!check_account.test(this.check.user)){
				this.tip.tip_user="格式不正确！用户名由数字、字母组成，长度为6-18位。且不能为数字开头"
				return false;
			}
			
			if(!check_account.test(this.check.passwords)){
				this.tip.tip_user="";
				this.tip.tip_passwords="格式不正确！密码由数字、字母组成，长度为6-18位。且不能为数字开头"
				return false;
			}
			if(this.check.passwords==this.check.user){
				this.tip.tip_user="";
				this.tip.tip_passwords="用户名和密码不能一样"
				return false;
			}
			if(this.check.comfirm_password !=this.check.passwords){
				this.tip.tip_passwords="";
				this.tip.tip_comfirm_password="两次输入不一样";
				return false;
			}
			
			if(!check_phone.test(phone.value)){
				this.tip.tip_comfirm_password="";
				this.tip.tip_phone="请输入正确的手机号码";
				return false;
			}

			if(selects=='1'){
				this.check.zjobj="身份证";
				this.tip.tip_phone="";
				var isIDCard1=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/; //15位数
				var isIDCard2=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
				if(isIDCard1.test(this.check.zjnumber)||isIDCard2.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "";
					
				}else{
					this.tip.tip_zjnumber = "请输入正确的身份证号码";
					return false;
				}
			}
			if(selects=='2'){
				this.check.zjobj="护照";
				this.tip.tip_phone="";
				var check = /^1[45][0-9]{7}|G[0-9]{8}|P[0-9]{7}|S[0-9]{7,8}|D[0-9]+$/
				if(!check.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "请输入正确的护照号码";
					return false;
				}
			}
			if(selects=='3'){
				this.check.zjobj="驾照";
				this.tip.tip_phone="";
				var check = /^[1-9]*[1-9][0-9]*$/;
				
				if(check.test(this.check.zjnumber)){
					this.tip.tip_zjnumber = "";
					
				}else{
					this.tip.tip_zjnumber = "请输入驾照号码";
					return false;
				}
			}
			
			if(this.check.tjphone==""){
				this.tip.tip_tjphone="";
			}
			else if(check_phone.test(this.check.tjphone)){
				this.tip.tip_tjphone="";				
			}else{
				this.tip.tip_tjphone="请输入正确的手机号码";
				return false;
			}
			
			
			//获取区号和国家
			var phone = document.getElementById("phone");
			var title = phone.parentNode.getElementsByClassName("selected-flag")[0]
			var spl = title.title.split(":");
			var op = spl[1].split(" ")[1]
			var country = spl[0];
			this.check.op = op;
			this.check.country = country;
			
			var hash_password = md5(this.check.passwords);
			this.$http.post(this.url_user_add,{
				name:this.check.user,
				password:hash_password,
				areaCode:this.check.op,
				telephone:phone.value,
				paperType:this.check.zjobj,
				paperNo:this.check.zjnumber,
				country:this.check.country,
				referee:this.check.tjphone
			}
			).then(function(res){
				sc_show(res.data.result);
			   	var t = setTimeout(function(){
			   		parent.location.reload();t=null;
			   	},1000)
			   	console.log(res)
			})
			
		}
	}
})
</script>

<script type="text/javascript">
$(function(){
	$(".permission-list dt input:checkbox").click(function(){
		$(this).closest("dl").find("dd input:checkbox").prop("checked",$(this).prop("checked"));
	});
	$(".permission-list2 dd input:checkbox").click(function(){
		var l =$(this).parent().parent().find("input:checked").length;
		var l2=$(this).parents(".permission-list").find(".permission-list2 dd").find("input:checked").length;
		if($(this).prop("checked")){

			$(this).closest("dl").find("dt input:checkbox").prop("checked",true);
			$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked",true);
		}
		else{
			if(l==0){
				$(this).closest("dl").find("dt input:checkbox").prop("checked",false);
			}
			if(l2==0){
				$(this).parents(".permission-list").find("dt").first().find("input:checkbox").prop("checked",false);
			}
		}
	});
	
	$("#form-admin-role-add").validate({
		rules:{
			roleName:{
				required:true,
			},
		},
		onkeyup:false,
		focusCleanup:true,
		success:"valid",
		submitHandler:function(form){
			$(form).ajaxSubmit();
			var index = parent.layer.getFrameIndex(window.name);
			parent.layer.close(index);
		}
	});
});
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>